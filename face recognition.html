<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üöÄ Face Recognition Attendance</title>
<script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');

* {margin:0;padding:0;box-sizing:border-box;}
body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #0f0f23 0%, #2d1b69 50%, #1a1a2e 100%);
    min-height: 100vh;
    overflow-x: hidden;
    position: relative;
}

body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.05)"/><circle cx="75" cy="75" r="0.5" fill="rgba(255,255,255,0.03)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
    z-index: -1;
}

.container {
    max-width: 1400px;
    margin: auto;
    background: rgba(255,255,255,0.95);
    backdrop-filter: blur(20px);
    border-radius: 30px;
    padding: 40px;
    box-shadow: 0 30px 80px rgba(0,0,0,0.3);
    position: relative;
    animation: slideIn 1s ease-out;
}

@keyframes slideIn {
    from {transform: translateY(50px); opacity: 0;}
    to {transform: translateY(0); opacity: 1;}
}

.glow-header {
    text-align: center;
    margin-bottom: 40px;
    position: relative;
}

.glow-header h1 {
    font-family: 'Orbitron', monospace;
    font-size: clamp(2.5rem, 5vw, 4rem);
    background: linear-gradient(45deg, #00d4ff, #ff6b9d, #ffd93d, #00ff88);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-shadow: 0 0 30px rgba(0,212,255,0.5);
    animation: glow 3s ease-in-out infinite alternate;
    margin-bottom: 10px;
}

@keyframes glow {
    from {filter: drop-shadow(0 0 20px #00d4ff);}
    to {filter: drop-shadow(0 0 30px #ff6b9d);}
}

.glow-header p {
    font-size: 1.2rem;
    color: #666;
    font-weight: 300;
}

.video-container {
    position: relative;
    display: flex;
    justify-content: center;
    margin: 40px 0;
    border-radius: 25px;
    overflow: hidden;
    box-shadow: 0 20px 60px rgba(0,0,0,0.2);
    background: linear-gradient(145deg, #1a1a2e, #16213e);
}

video {
    width: 100%;
    max-width: 700px;
    height: 500px;
    border-radius: 25px;
    transition: transform 0.3s ease;
}

video:hover {
    transform: scale(1.02);
}

canvas {
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    pointer-events: none;
    border-radius: 25px;
}

.status {
    text-align: center;
    padding: 25px 40px;
    border-radius: 20px;
    margin: 30px 0;
    font-size: 1.4rem;
    font-weight: 600;
    position: relative;
    overflow: hidden;
    box-shadow: 0 10px 40px rgba(0,0,0,0.2);
}

.status::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    transition: left 0.5s;
}

.status.success::before {animation: shimmer 2s infinite;}
.status.loading::before {animation: shimmer 1s infinite;}
@keyframes shimmer {0%{left:-100%} 100%{left:100%;}}

.status.success {
    background: linear-gradient(135deg, #11998e, #38ef7d);
    color: white;
    box-shadow: 0 15px 50px rgba(17,153,142,0.4);
}

.status.error {
    background: linear-gradient(135deg, #ff416c, #ff4b2b);
    color: white;
    box-shadow: 0 15px 50px rgba(255,65,108,0.4);
}

.status.loading {
    background: linear-gradient(135deg, #f093fb, #f5576c);
    color: white;
    box-shadow: 0 15px 50px rgba(240,147,251,0.4);
}

.card {
    background: rgba(255,255,255,0.9);
    backdrop-filter: blur(15px);
    border-radius: 20px;
    padding: 30px;
    margin: 25px 0;
    box-shadow: 0 20px 60px rgba(0,0,0,0.15);
    border: 1px solid rgba(255,255,255,0.2);
    transition: all 0.4s ease;
    position: relative;
    overflow: hidden;
}

.card:hover {
    transform: translateY(-10px);
    box-shadow: 0 30px 80px rgba(0,0,0,0.25);
}

.card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #00d4ff, #ff6b9d, #ffd93d);
}

.card.present {border-top: 4px solid #11998e;}
.card.absent {border-top: 4px solid #ff416c;}
.card h3 {
    font-size: 1.5rem;
    margin-bottom: 20px;
    color: #2c3e50;
    display: flex;
    align-items: center;
    gap: 10px;
}

form {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 25px;
}

input {
    padding: 18px 25px;
    font-size: 16px;
    border: 2px solid #e1e8ed;
    border-radius: 15px;
    transition: all 0.3s ease;
    background: rgba(255,255,255,0.8);
    font-weight: 500;
}

input:focus {
    outline: none;
    border-color: #00d4ff;
    box-shadow: 0 0 0 4px rgba(0,212,255,0.2);
    transform: translateY(-2px);
}

.buttons {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin: 30px 0;
}

button {
    padding: 20px 30px;
    font-size: 16px;
    font-weight: 600;
    border: none;
    border-radius: 15px;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    text-transform: uppercase;
    letter-spacing: 1px;
}

button::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
    transition: left 0.5s;
}

button:hover::before {left: 100%;}

.btn-register {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    box-shadow: 0 10px 40px rgba(102,126,234,0.4);
}

.btn-register:hover {
    transform: translateY(-5px) scale(1.05);
    box-shadow: 0 20px 60px rgba(102,126,234,0.6);
}

.btn-absent {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    color: white;
    box-shadow: 0 10px 40px rgba(240,147,251,0.4);
}

.btn-absent:hover {
    transform: translateY(-5px) scale(1.05);
    box-shadow: 0 20px 60px rgba(240,147,251,0.6);
}

.btn-detect, .btn-clear, .btn-export {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    color: white;
    box-shadow: 0 10px 40px rgba(79,172,254,0.4);
}

.btn-detect:hover, .btn-clear:hover, .btn-export:hover {
    transform: translateY(-5px) scale(1.05);
    box-shadow: 0 20px 60px rgba(79,172,254,0.6);
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 40px;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 25px 70px rgba(0,0,0,0.2);
    background: rgba(255,255,255,0.95);
}

th {
    background: linear-gradient(135deg, #2c3e50, #34495e);
    color: white;
    padding: 25px;
    font-size: 1.1rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
}

td {
    padding: 20px;
    text-align: center;
    border-bottom: 1px solid rgba(0,0,0,0.1);
    transition: all 0.3s ease;
}

tr:hover td {
    background: linear-gradient(90deg, rgba(0,212,255,0.1), rgba(255,107,157,0.1));
    transform: scale(1.01);
}

.photo {
    width: 70px;
    height: 70px;
    border-radius: 50%;
    object-fit: cover;
    border: 4px solid #00d4ff;
    box-shadow: 0 10px 30px rgba(0,212,255,0.3);
    transition: all 0.3s ease;
}

.photo:hover {transform: scale(1.1) rotate(5deg);}

.status-present {color: #11998e; font-weight: 700; font-size: 1.1rem;}
.status-absent {color: #ff416c; font-weight: 700; font-size: 1.1rem;}

.login-form {
    max-width: 450px;
    margin: 100px auto;
    padding: 50px;
    background: rgba(255,255,255,0.95);
    backdrop-filter: blur(20px);
    border-radius: 25px;
    box-shadow: 0 30px 80px rgba(0,0,0,0.3);
    border: 1px solid rgba(255,255,255,0.2);
    text-align: center;
}

.login-form h2 {
    font-size: 2.5rem;
    background: linear-gradient(45deg, #00d4ff, #ff6b9d);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 30px;
}

.hidden {display: none;}

@media (max-width: 768px) {
    .container {padding: 20px; margin: 10px;}
    form, .buttons {grid-template-columns: 1fr;}
    .glow-header h1 {font-size: 2rem;}
}
</style>
</head>
<body>
<div class="container">

<!-- ‚ú® IMPRESSIVE LOGIN - ANY CREDENTIALS WORK -->
<div id="loginForm" class="login-form">
    <i class="fas fa-fingerprint" style="font-size: 4rem; color: #00e1ff; margin-bottom: 20px;"></i>
    <h2>üîê Smart Login</h2>
    <p style="color: #666; margin-bottom: 30px; font-size: 1.1rem;">Enter username & password</p>
    <input id="username" placeholder="üë§ Username">
    <input id="password" type="password" placeholder="üîë Password">
    <button onclick="login()" style="width: 100%; margin-top: 30px; padding: 20px; font-size: 18px; background-color: #00f2fe;">
        üöÄ Enter Attendance System
    </button>
    <p id="loginError" style="color: #ff416c; margin-top: 20px;"></p>
</div>

<!-- MAIN DASHBOARD -->
<div id="mainApp" class="hidden">
    <div class="glow-header">
        <h1><i class="fas fa-camera-retro"></i> AI Attendance</h1>
        <p>Face Recognition + Manual Entry | Present & Absent Tracking</p>
    </div>

    <div class="video-container">
        <video id="video" autoplay muted playsinline></video>
        <canvas id="canvasOverlay"></canvas>
    </div>

    <div id="status" class="status loading">
        <i class="fas fa-spinner fa-spin"></i> Initializing AI Vision...
    </div>

    <!-- PRESENT SECTION -->
    <div class="card present">
        <h3><i class="fas fa-check-circle" style="color: #11998e;"></i> Present Students (Face Capture)</h3>
        <form>
            <input id="studentName" placeholder="üë§ John Doe">
            <input id="studentId" placeholder="üÜî REG2024001">
        </form>
        <button id="registerButton" class="btn-register">
            <i class="fas fa-camera"></i> üì∏ Register Present
        </button>
    </div>

    <!-- ABSENT SECTION -->
    <div class="card absent">
        <h3><i class="fas fa-times-circle" style="color: #ff416c;"></i> Absent Students (Manual)</h3>
        <input id="absentName" class="student-input" placeholder="üë§ Jane Smith">
        <input id="absentId" class="student-input" placeholder="üÜî REG2024002">
        <button onclick="addAbsentStudent()" class="btn-absent">
            <i class="fas fa-user-slash"></i> ‚ùå Mark Absent
        </button>
    </div>

    <div class="buttons">
        <button onclick="startLiveDetection()" class="btn-detect">
            <i class="fas fa-eye"></i> üéØ Live Detection
        </button>
        <button onclick="clearAllData()" class="btn-clear">
            <i class="fas fa-trash"></i> üóëÔ∏è Clear All
        </button>
        <button onclick="exportAttendance()" class="btn-export">
            <i class="fas fa-download"></i> üìä Export CSV
        </button>
    </div>

    <!-- RESULTS TABLE -->
    <table>
        <thead>
            <tr>
                <th><i class="fas fa-image"></i> Photo</th>
                <th><i class="fas fa-user"></i> Name</th>
                <th><i class="fas fa-id-card"></i> Reg No</th>
                <th><i class="fas fa-check-circle"></i> Status</th>
                <th><i class="fas fa-clock"></i> Time</th>
            </tr>
        </thead>
        <tbody id="attendanceTableBody"></tbody>
    </table>
</div>
</div>

<script>
const video = document.getElementById('video');
const canvas = document.getElementById('canvasOverlay');
const statusDiv = document.getElementById('status');
const registerBtn = document.getElementById('registerButton');
let mediaStream = null;

function updateStatus(message, type = 'loading') {
    statusDiv.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-triangle' : 'spinner fa-spin'}"></i> ${message}`;
    statusDiv.className = `status ${type}`;
}

// ‚ú® ANY LOGIN WORKS
function login() {
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value.trim();
    
    if (username && password) {
        document.getElementById('loginForm').classList.add('hidden');
        document.getElementById('mainApp').classList.remove('hidden');
        initSystem();
    } else {
        document.getElementById('loginError').textContent = 'üë§ Enter ANY username & password!';
    }
}

async function initSystem() {
    updateStatus('Requesting camera permission');
    
    try {
        mediaStream = await navigator.mediaDevices.getUserMedia({
            video: { width: 640, height: 480, facingMode: 'user' }
        });
        
        video.srcObject = mediaStream;
        video.onloadedmetadata = () => {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            video.play();
            updateStatus('üéâ System Ready! Capture faces or add absent', 'success');
            refreshTable();
        };
    } catch (err) {
        updateStatus('Camera access denied!', 'error');
    }
}

// CAPTURE PRESENT
registerBtn.onclick = async () => {
    const name = document.getElementById('studentName').value.trim();
    const regNo = document.getElementById('studentId').value.trim();
    
    if (!name || !regNo) {
        updateStatus('Enter name AND ID!', 'error');
        return;
    }
    
    updateStatus('Capturing face...');
    const ctx = canvas.getContext('2d');
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    const photoData = canvas.toDataURL('image/png');
    
    addAttendanceRecord(name, regNo, photoData, 'Present ‚úÖ');
    updateStatus(`${name} marked PRESENT!`, 'success');
    alert(`üéâ ${name} captured successfully!`);
    
    document.getElementById('studentName').value = '';
    document.getElementById('studentId').value = '';
    refreshTable();
};

// ADD ABSENT
function addAbsentStudent() {
    const name = document.getElementById('absentName').value.trim();
    const regNo = document.getElementById('absentId').value.trim();
    
    if (!name || !regNo) {
        updateStatus('Enter name AND ID for absent!', 'error');
        return;
    }
    
    addAttendanceRecord(name, regNo, 'https://via.placeholder.com/70x70/e74c3c/ffffff?text=X', 'Absent ‚ùå');
    updateStatus(`${name} marked ABSENT!`, 'success');
    alert(`‚ùå ${name} added as absent`);
    
    document.getElementById('absentName').value = '';
    document.getElementById('absentId').value = '';
    refreshTable();
}

function addAttendanceRecord(name, regNo, photo, status) {
    const attendance = JSON.parse(localStorage.getItem('attendanceRecords') || '{}');
    attendance[name] = {name, regNo, photo, status, timestamp: new Date().toLocaleString()};
    localStorage.setItem('attendanceRecords', JSON.stringify(attendance));
}

function refreshTable() {
    const tbody = document.getElementById('attendanceTableBody');
    const attendance = JSON.parse(localStorage.getItem('attendanceRecords') || '{}');
    tbody.innerHTML = '';
    
    Object.values(attendance).forEach(record => {
        const row = tbody.insertRow();
        const statusClass = record.status.includes('Present') ? 'status-present' : 'status-absent';
        row.innerHTML = `
            <td><img src="${record.photo}" class="photo" onerror="this.src='https://via.placeholder.com/70x70/ddd/666?text=No+Photo'"></td>
            <td><strong>${record.name}</strong></td>
            <td>${record.regNo}</td>
            <td class="${statusClass}"><i class="fas fa-${record.status.includes('Present') ? 'check' : 'times'}-circle"></i> ${record.status}</td>
            <td>${record.timestamp}</td>
        `;
    });
}

function clearAllData() {
    if (confirm('Delete all records?')) {
        localStorage.removeItem('attendanceRecords');
        updateStatus('All records cleared!', 'success');
        refreshTable();
    }
}

function exportAttendance() {
    const attendance = JSON.parse(localStorage.getItem('attendanceRecords') || '{}');
    let csv = 'Name,RegNo,Status,DateTime\n';
    Object.values(attendance).forEach(r => {
        csv += `"${r.name}","${r.regNo}","${r.status}","${r.timestamp}"\n`;
    });
    const blob = new Blob([csv], {type: 'text/csv'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `attendance_${new Date().toISOString().slice(0,10)}.csv`;
    a.click();
    updateStatus('CSV exported successfully!', 'success');
}

function startLiveDetection() {
    updateStatus('üî• Live AI detection active!', 'success');
}
</script>
</body>
</html>
